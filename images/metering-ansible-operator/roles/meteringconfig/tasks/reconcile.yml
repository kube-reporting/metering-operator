---

- name: Validate storage con***REMOVED***guration
  assert:
    that:
      - meteringcon***REMOVED***g_spec | json_query('storage.type') == "hive"
    msg: "Unsupported spec.storage.type, only 'hive' is  a supported option"

- name: Validate Hive storage con***REMOVED***guration
  assert:
    that:
      - hiveStorageType is not unde***REMOVED***ned and hiveStorageType in ['s3', 'sharedPVC', 'hdfs', 'azure']
    msg: "Invalid spec.storage.hive.type: '{{ hiveStorageType }}', must be one of 's3', 'azure', or 'sharedPVC'"
  vars:
    hiveStorageType: "{{ meteringcon***REMOVED***g_spec_overrides | json_query('storage.hive.type') }}"

- name: Con***REMOVED***gure TLS
  include_tasks: con***REMOVED***gure_tls.yml

- name: Con***REMOVED***gure Reporting
  include_tasks: con***REMOVED***gure_reporting.yml

- name: Con***REMOVED***gure Storage
  include_tasks: con***REMOVED***gure_storage.yml

- name: Store MeteringCon***REMOVED***g spec into values ***REMOVED***le
  copy: content="{{ meteringcon***REMOVED***g_spec }}" dest=/tmp/metering-values.yaml

- include_tasks: "{{ item }}"
  loop:
    - reconcile_metering.yml
    - reconcile_monitoring.yml
    - reconcile_hdfs.yml
    - reconcile_hive.yml
    - reconcile_presto.yml
    - reconcile_reporting_operator.yml
    - reconcile_reporting.yml
