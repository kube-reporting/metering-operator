kind: Service
apiVersion: v1
metadata:
  name: metering
  labels:
    app: metering
{{- if .Values.service.annotations }}
  annotations:
{{ toYaml .Values.service.annotations | indent 4 }}
{{- end }}
{{- block "extraMetadata" . }}
{{- end }}
spec:
  type: "{{ .Values.service.type }}"
  selector:
    app: metering
  ports:
  - protocol: TCP
    port: 8080
    targetPort: http
    name: http
{{- if and (eq (lower .Values.service.type) "nodeport" "loadbalancer") .Values.service.nodePort }}
    nodePort: {{ .Values.service.nodePort }}
{{- end }}
  - protocol: TCP
    port: 8082
    targetPort: metrics
    name: metrics
